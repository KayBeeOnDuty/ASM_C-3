@model ASM_C_3.Models.Invoice

@{
    ViewData["Title"] = "Edit Invoice";
}

<h1 class="mb-3">Edit Invoice</h1>

<form asp-action="Edit" method="post" class="needs-validation" novalidate>
    @Html.AntiForgeryToken()
    <input type="hidden" asp-for="InvoiceId" />
    <div asp-validation-summary="ModelOnly" class="text-danger mb-3"></div>

    <div class="row g-3">
        <!-- Chọn khách hàng -->
        <div class="col-md-6">
            <label asp-for="UserId" class="form-label"></label>
            <select asp-for="UserId" class="form-select"
                    asp-items="@(new SelectList(ViewBag.Users, "UserId", "FullName", Model.UserId))">
                <option value="">-- Select Customer --</option>
            </select>
            <span asp-validation-for="UserId" class="text-danger"></span>
        </div>

        <!-- Chọn phương thức thanh toán -->
        <div class="col-md-6">
            <label asp-for="PayMethod" class="form-label"></label>
            <select asp-for="PayMethod" class="form-select">
                <option value="">-- Select Payment Method --</option>
                @foreach (var method in Enum.GetValues(typeof(ASM_C_3.Models.PayMethod)))
                {
                    <option value="@method" selected="@(Model.PayMethod == (ASM_C_3.Models.PayMethod)method)">
                        @method
                    </option>
                }
            </select>
            <span asp-validation-for="PayMethod" class="text-danger"></span>
        </div>

        <!-- Ngày lập hóa đơn -->
        <div class="col-md-4">
            <label asp-for="CreatedDate" class="form-label"></label>
            <input asp-for="CreatedDate" class="form-control" type="datetime-local" />
            <span asp-validation-for="CreatedDate" class="text-danger"></span>
        </div>

        <!-- Tổng tiền -->
        <div class="col-md-4">
            <label asp-for="TotalAmount" class="form-label"></label>
            <input asp-for="TotalAmount" class="form-control" />
            <span asp-validation-for="TotalAmount" class="text-danger"></span>
        </div>
    </div>

    <!-- Danh sách sản phẩm chi tiết (nếu có) -->
    <div class="mt-4">
        <h5>Invoice Details</h5>
        <table class="table table-bordered align-middle">
            <thead class="table-light">
                <tr>
                    <th>Product</th>
                    <th>Variant</th>
                    <th>Quantity</th>
                    <th>Unit Price</th>
                    <th>Subtotal</th>
                </tr>
            </thead>
            <tbody>
                @if (Model.InvoiceDetails != null && Model.InvoiceDetails.Any())
                {
                    foreach (var item in Model.InvoiceDetails)
                    {
                        <tr>
                            <td>@item.Variant?.Product?.Name</td>
                            <td>@item.Variant?.Name</td>
                            <td>@item.Quantity</td>
                            <td>@item.UnitPrice.ToString("C")</td>
                            <td>@item.Subtotal.ToString("C")</td>
                        </tr>
                    }
                }
                else
                {
                    <tr>
                        <td colspan="5" class="text-center text-muted">No items in this invoice</td>
                    </tr>
                }
            </tbody>
        </table>
    </div>

    <div class="d-flex gap-2 mt-4">
        <button type="submit" class="btn btn-primary">Update</button>
        <a asp-action="Index" class="btn btn-secondary">Back</a>
    </div>
</form>

@section Scripts {
    <partial name="_ValidationScriptsPartial" />
}
